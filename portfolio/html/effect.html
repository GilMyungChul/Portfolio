<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title></title>
    
    <link rel="stylesheet" href="../css/reset.css">

    <script type="text/javascript" src="../js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="../js/jquery-ui.min.js"></script>

    <style>
        html{overflow:hidden;}
        
        .effectRain{width:500px;height:500px;overflow:hidden;position:relative;margin:50px auto 0;}
        .effectRain li{width:4px;height:50px;position:absolute;background:#326faf;top:0;font-size:0px;}
        .effectRain li img{width:100%;}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="slowDwon">
            <ul class="effectRain"></ul>
        </div>
    </div>

    <script>
        
        function effect(opt) {

            this.pageXY = function(e) {
                var pageX = e.originalEvent.changedTouches ? e.originalEvent.changedTouches[0].pageX : e.originalEvent.pageX;                               // swiper X축
                var pageY = e.originalEvent.changedTouches ? e.originalEvent.changedTouches[0].pageY : e.originalEvent.pageY;                               // swiper Y축
                var pageXY = new Array(pageX, pageY);

                return pageXY;
            };
            
            this.effectMode = opt.effectMode,
            this.target = opt.target,
            this.number = opt.number,
            this.speed = opt.speed || 1,
            this.delay = opt.delay || 1000,

            this.randomValue;

            if (this.effectMode == 'rain') {                                                                                                                // 슬로우 다운 (비내리는 효과)
                this.rainObj = opt.rainObj;
                this.rainList;
                this.rainH;
                this.rainObjH = $(this.rainObj).height();

                this.targetW = this.target.width();
                this.targetH = this.target.height();

                this.offsetX = this.target.offset().left;
                this.offsetY = this.target.offset().top;

                this.rainObjX;
                this.rainObjY;

                this.min = 0;
                this.max = this.targetW;

                this.rainX;

                this.rainMoveChk = false;
            }

            this.winH = $(window).height();
            this.winW = $(window).width();

            this.init();
        }

        effect.prototype = {
            init : function() {

                this.events();

                // effectMode = rain
                if (this.effectMode = 'rain') {
                    this.rainInit();
                    this.rainSetInterval();
                }
            },

            events : function() {
                var _this = this;

                if (_this.effectMode = 'rain') {
                    $(_this.target)
                        .unbind('mouseenter').bind('mouseenter', _this, function(e){_this.rainEnter(e)})
                        .unbind('mousemove').bind('mousemove', _this, function(e){if (_this.rainMoveChk) {_this.rainMove(e)}})
                        .unbind('mouseleave').bind('mouseleave', _this, function(e){_this.rainLeave(e)});
                }
            },

            rainEnter : function(e) {
                var _this = e.data;
                _this.rainMoveChk = true;

                _this.rainX = e.originalEvent.pageX;
            },

            rainMove : function(e, _random) {
                console.log(_random)
                var _this = e.data;
                var _per = 45 / ($(_this.target).width()/2)
                var _val = ($(this.target).width()/2 + _this.offsetX) - _this.pageXY(e)[0];

                $(_this.rainObj).css({'transform': 'rotate(' + (_per * _val) + 'deg)', 'transition-duration': 0 + 's'});
            },

            rainLeave : function(e) {
                var _this = e.data;
                _this.rainMoveChk = false;
            },

            rainInit : function() {
                var _this = this;
                for (var i = 1; i <= _this.number; i++) {
                    _this.randomValue = parseInt(Math.random() * (_this.max - _this.min) + _this.min);
                    var rainList = '<' + _this.rainObj + ' data-rainList="' + i +'" style="left:' + _this.randomValue + 'px">' + i + '</' + _this.rainObj + '>';
                    $(_this.target).append(rainList);
                }

                this.rainH = $('[data-rainList]').height();
                $('[data-rainList]').css({'top': -this.rainH + 'px'});
            },

            rainSetInterval : function(e) {
                var _this = this;
                setInterval(function(){
                    _this.randomValue = parseInt(Math.random() * (_this.number - 0) + 0);
                    $('[data-rainList="' + _this.randomValue + '"]').css({'top': _this.targetH + _this.rainH, 'transition-duration': _this.speed + 's'});

                    _this.transitionEnd(_this.randomValue);
                    _this.rainMove(e, _this.randomValue);
                }, _this.delay);
            },

            transitionEnd : function(_random) {
                var _this = this;
                
                $('[data-rainList="' + _random + '"]').bind('transitionend webkitTransitionEnd', _this, function(e){
                    $('[data-rainList="' + _random + '"]').unbind('transitionend webkitTransitionEnd');
                    $('[data-rainList="' + _random + '"]').css({'top': - _this.rainH + 'px', 'transition-duration': 0 + 's'});
                })
            }   
        }
        
    </script>

    <script>
        
        var rain = new effect({
            effectMode: 'rain',
            target: $('.effectRain'),
            rainObj: 'li',
            number: 50,
            speed: 2.5,
            delay: 500
        })
    </script>
</body>
</html>
